<article><header><h1 class="docTitle_cWlf">版本说明 - v2.4.8</h1></header><div class="markdown"><p>Rancher 2.4.8 版本于 2020 年 9 月 4 日发布。Rancher 2.4.8 解决了 Rancher v2.4.6 中新引入的设置（auth-token-max-ttl-minutes）有关的问题。除了以下变化，版本说明与 v2.4.6 相同。点击<a href="https://github.com/rancher/rancher/releases/tag/v2.4.8">这里</a>查看英文版版本说明。</p><ul><li><p>修正了一个 UI 问题，在这个问题上，列出 KMS 密钥需要权限才能修改 AWS 节点模板<a href="https://github.com/rancher/rancher/issues/28724">#28724</a>。</p></li><li><p>修正了 k8s go-client 与旧版 k8s 不兼容的问题，它可能会引起<code>Timeout: Too large resource version</code>错误。注意：该消息对集群没有已知的直接影响<a href="https://github.com/rancher/rancher/issues/28623">#28623</a>。</p></li><li><p>修正了新设置的默认值（auth-token-max-ttl-minutes）</p><ul><li><p>修正了在 v2.4.6 中创建的新 API 令牌会在 24 小时内默认过期的问题。该设置现在默认为 0，允许令牌永不过期，与 v2.4.5 类似<a href="https://github.com/rancher/rancher/issues/28668">#28668</a></p></li><li><p>修正了一个用户界面问题，如果 API 令牌以非零 TTL 创建，他们会有错误的到期时间戳，并且在 v2.4.6 中引入的新设置 auth-token-max-ttl-minutes 被设置为 0（永不过期）<a href="https://github.com/rancher/rancher/issues/28678">#28678</a></p></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="解决安全漏洞"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#解决安全漏洞" title="Direct link to heading">#</a>解决安全漏洞</h2><ul><li><p>升级了 Rancher 使用的 Helm 版本，现在使用的是 Helm v2.16.8，以解决 <a href="https://github.com/helm/helm/releases/tag/v2.16.8">CVE-2020-7919</a> [<a href="https://github.com/rancher/rancher/pull/27568">PR-27568</a>]这个问题。</p></li><li><p>升级了 Rancher 的监控工具 Grafana 的版本，以解决<a href="https://grafana.com/blog/2020/06/03/grafana-6.7.4-and-7.0.2-released-with-important-security-fix/">CVE-2020-13379</a> [<a href="https://github.com/rancher/rancher/issues/27418">#27418</a>]这个问题。</p></li><li><p>升级了 Rancher 中的 Istio 的版本，以解决<a href="https://istio.io/latest/news/releases/1.4.x/announcing-1.4.9/">ISTIO-SECURITY-2020-005</a> [<a href="https://github.com/rancher/rancher/issues/27064">#27064</a>]这个问题。</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="重要说明"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#重要说明" title="Direct link to heading">#</a>重要说明</h2><ul><li><p><strong>请阅读<a href="/docs/rancher2/releases/v2.4.0/">v2.4.0 版本说明</a>中的重要更新和重大改动的说明</strong>。</p></li><li><p><strong>Kubernetes 1.18 现在为默认版本 [<a href="https://github.com/rancher/rancher/issues/25117">#25117</a>]：</strong> Kubernetes 1.18 现在为默认版本。在任何时候升级 Kubernetes 版本之前，请阅读 Kubernetes 的版本说明，来了解重要变更。</p></li><li><p><strong>使用单节点 Docker 安装的用户请注意：</strong> Docker 容器中的 Etcd 已从 3.3 升级到了 3.4，因此，您必须在升级之前进行备份，以便能够回滚到 v2.3.x 版本。没有此备份，将无法回滚。</p></li><li><p><strong>使用节点池功能，并使用 RHEL/CentOS 的用户请注意 [<a href="https://github.com/rancher/rancher/issues/18065">#18065</a>]：</strong> RHEL / CentOS 节点的默认存储驱动已更新为<code>overlay2</code>。如果您的节点模板未指定存储驱动，则在使用该模版创建新节点时，将使用默认值<code>overlay2</code>而不是之前的<code>devicemapper</code>作为存储驱动。如果您需要继续使用<code>devicemapper</code>作为存储驱动选项，请编辑节点模板，并将存储驱动显式设置为 <code>devicemapper</code></p></li><li><p><strong>使用 Windows 集群的用户请注意 [<a href="https://github.com/rancher/rancher/issues/25582">#25582</a>]：</strong> Windows 已于 2 月 11 日发布了安全补丁程序。升级之前，请更新您的节点以包括此安全补丁程序，否则，升级将失败，直到您使用该补丁程序为止。</p></li><li><p><strong>Rancher 部署的集群（RKE 集群）需要额外的 500MB 磁盘空间</strong> Rancher 部署的集群（RKE 集群）默认开启了审计日志功能。</p></li><li><p><strong>Rancher 部署的集群（RKE 集群）升级方式发生了变化 [<a href="https://github.com/rancher/rancher/issues/23897">#23897</a>]：</strong> 请参考零宕机升级功能以了解更多信息。</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="版本"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#版本" title="Direct link to heading">#</a>版本</h2><p>下面的版本为当前的最新版和稳定版：</p><table><thead><tr><th align="left">类型</th><th align="left">Rancher 版本</th><th align="left">Docker 标签</th><th align="left">Helm 仓库</th><th align="left">Helm Chart 版本</th></tr></thead><tbody><tr><td align="left">最新版</td><td align="left">v2.4.8</td><td align="left"><code>rancher/rancher:latest</code></td><td align="left">server-charts/latest</td><td align="left">v2.4.8</td></tr><tr><td align="left">稳定版</td><td align="left">v2.4.8</td><td align="left"><code>rancher/rancher:stable</code></td><td align="left">server-charts/stable</td><td align="left">v2.4.8</td></tr></tbody></table><p>您可以通过<a href="/docs/rancher2/installation/options/server-tags/_index">如何选择版本的文档</a>，了解更多关于不同版本和标签的区别。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="功能和优化"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#功能和优化" title="Direct link to heading">#</a>功能和优化</h2><p>Kubeconfig API 令牌现在支持 TTL[<a href="https://github.com/rancher/rancher/issues/28378">#28378</a>]。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="自-v245-以来修复的主要问题"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#自-v245-以来修复的主要问题" title="Direct link to heading">#</a>自 v2.4.5 以来修复的主要问题</h2><ul><li><p>Windows 集群现在支持前缀路径，并且通过新的 win_configs 只支持 Windows 的 args/env/binds[<a href="https://github.com/rancher/rancher/issues/28413">#28413</a>]、[<a href="https://github.com/rancher/rancher/issues/25108">#25108</a>]。</p></li><li><p>改进了删除 RKE 模板的操作[<a href="https://github.com/rancher/rancher/issues/26861">26861</a>]。</p></li><li><p>修正了一些 S3 Bucket 供应商（如 NetApp StorageGRID）的 ETCD 快照恢复[<a href="https://github.com/rancher/rancher/issues/27608">27608</a>]。</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="自-v245-以来修复的小问题"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#自-v245-以来修复的小问题" title="Direct link to heading">#</a>自 v2.4.5 以来修复的小问题</h2><ul><li><p>修正了从本地目录安装 Helm 图表时的授权错误 <a href="https://github.com/rancher/rancher/issues/23832">#23832</a></p></li><li><p>超时：在 k8s v1.18 上修正了资源版本列表过大的错误 <a href="https://github.com/rancher/rancher/issues/28477">#28477</a></p></li><li><p>Kiali Traffic Graphs 1.5.x 可用 <a href="https://github.com/rancher/rancher/issues/28109">#28109</a></p></li><li><p>Rancher Kubernetes Auth Proxy 现在利用转发代理 <a href="https://github.com/rancher/rancher/issues/25488">#25488</a></p></li><li><p>修正了 cli 和--format 标志的一个错误 <a href="https://github.com/rancher/rancher/issues/27661">#27661</a></p></li><li><p>修正了 cli 和--value 标���的一个错误 <a href="https://github.com/rancher/rancher/issues/27346">#27346</a></p></li><li><p>修正了一个编辑多集群应用程序的错误 <a href="https://github.com/rancher/rancher/issues/27416">#27416</a></p></li><li><p>修正了一个 draining 节点的错误 <a href="https://github.com/rancher/rancher/issues/23333">#23333</a></p></li><li><p>修正了一个节点池的错误，非创建者也可以缩放节点池<a href="https://github.com/rancher/rancher/issues/27031">#27031</a></p></li><li><p>修正了一个加密 Azure AD 密钥的错误。 <a href="https://github.com/rancher/rancher/issues/27774">#27774</a></p></li><li><p>超出上下文最后期限而导致日志被淹没的超时延长 <a href="https://github.com/rancher/rancher/issues/27736">#27736</a></p></li><li><p>RKE 快照现在可以存储用于备份还原的证书 <a href="https://github.com/rancher/rke/issues/">#1336</a></p></li><li><p>配置地图和秘密的名称中现在接受“.”符号 <a href="https://github.com/rancher/rancher/issues/25955">#25955</a></p></li><li><p>修正了一些用户界面问题</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="其他说明"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#其他说明" title="Direct link to heading">#</a>其他说明</h2><ul><li><p>Rancher 机器创建的节点现在默认为 overlay2 文件系统 <a href="https://github.com/rancher/rancher/issues/27414">#27414</a></p></li><li><p>默认 CIS 扫描版本改为 v1.5 <a href="https://github.com/rancher/rancher/issues/27446">#27446</a></p></li><li><p>EC2 节点模板现在支持 KMS 加密密钥 <a href="https://github.com/rancher/rancher/issues/27965">#27965</a></p></li><li><p>EC2 Node 模板现在支持 MetadataOptions <a href="https://github.com/rancher/rancher/issues/25078">#25078</a></p></li><li><p>新增通知方式：Microsoft Teams <a href="https://github.com/rancher/rancher/issues/15802">#15802</a></p></li><li><p>Cluster API lister 现在使用 auth cache 来提高速度 <a href="https://github.com/rancher/rancher/issues/27192">#27192</a></p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="离线安装和升级"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#离线安装和升级" title="Direct link to heading">#</a>离线安装和升级</h3><p>在 v2.4.0 的版本里，离线安装将不在需要手动同步 system charts 的源代码仓库了。具体操作请参阅有关<a href="/docs/rancher2/installation/other-installation-methods/air-gap/install-rancher/_index">安装 Rancher 时，如何使用内嵌的 system charts</a>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="主要的已知问题"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#主要的已知问题" title="Direct link to heading">#</a>主要的已知问题</h3><ul><li><p>启用 Grafana 和持久存储时，升级监控工具会导致 pod 无法启动。解决方法请参考[<a href="https://github.com/rancher/rancher/issues/27450">#27450</a>]。</p></li><li><p>将新的 chart 版本添加到 Helm3 应用商店的时候，升级时默认使用的是 Helm2 而不是 Helm3，导致出现 API 错误。解决方法请参考[<a href="https://github.com/rancher/rancher/issues/27252">27252</a>]。</p></li><li><p>使用监控时，升级 Kubernetes 版本会删除 API Server Request Rate 监控参数<a href="https://github.com/rancher/rancher/issues/27267">#27267</a>]。</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="版本信息"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#版本信息" title="Direct link to heading">#</a>版本信息</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="镜像"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#镜像" title="Direct link to heading">#</a>镜像</h3><ul><li>rancher/rancher:v2.4.8</li><li>rancher/rancher-agent:v2.4.8</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="工具"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#工具" title="Direct link to heading">#</a>工具</h3><ul><li>cli - <a href="https://github.com/rancher/rancher/releases/tag/v2.4.8">v2.4.8</a></li><li>rke - <a href="https://github.com/rancher/rke/releases/tag/v1.1.6">v1.1.6</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="kubernete-版本"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#kubernete-版本" title="Direct link to heading">#</a>Kubernete 版本</h3><ul><li><a href="https://github.com/rancher/hyperkube/releases/tag/v1.18.6-rancher1">1.18.6</a>(默认版本）</li><li><a href="https://github.com/rancher/hyperkube/releases/tag/v1.17.9-rancher1">1.17.9</a></li><li><a href="https://github.com/rancher/hyperkube/releases/tag/v1.16.13-rancher1">1.16.13</a></li><li><a href="https://github.com/rancher/hyperkube/releases/tag/v1.15.12-rancher2">1.15.12</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="升级和回滚"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#升级和回滚" title="Direct link to heading">#</a>升级和回滚</h2><p>Rancher 支持<a href="/docs/rancher2/upgrades/_index">升级</a>和<a href="/docs/rancher2/upgrades/rollbacks/_index">回滚</a>操作。在修改 Rancher 版本时，请先确认您要升级到或者回滚到的 Rancher 版本。</p><p>请注意，在升级到 v2.3.0 或者以上版本时，第一次修改通过 Rancher v2.3.0 之前版本部署的 RKE 集群时，由于要向系统组件中加入 Tolerations，该集群全部的系统组件将会自动重启。请事先规划好。</p><p>如果您的 Rancher HA 在使用 低于 v0.9.1 的 cert-manager，并且是自签名证书，由于 cert-manager 最新的变化，您需要升级 cert-manager 的版本。具体操作请参阅有关<a href="/docs/rancher2/installation/options/upgrading-cert-manager/_index">如何升级 cert-manager</a>的文档。</p><p><strong>重要：</strong>回滚时，我们建议回滚至升级前的状态，Rancher 不会保留回滚前的修改。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="assets"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#assets" title="Direct link to heading">#</a>Assets</h2><p>请在<a href="https://github.com/rancher/rancher/releases/tag/v2.4.8">这里</a>获取该版本的 Assets。</p></div></article>